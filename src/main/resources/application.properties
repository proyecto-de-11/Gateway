# ============================================
# CONFIGURACIÓN BÁSICA
# ============================================
spring.application.name=Gateway
server.port=${PORT:8080}

# ============================================
# SPRING CLOUD CONFIG
# ============================================
spring.cloud.config.enabled=false
spring.cloud.compatibility-verifier.enabled=false

# ============================================
# CONFIGURACIÓN DE EUREKA CLIENT PARA RENDER
# ============================================
# URL del servidor Eureka en Render
eureka.client.service-url.defaultZone=https://eurekaserver-vej9.onrender.com/eureka/

# Configuración de la instancia para HTTPS
eureka.instance.instance-id=${spring.application.name}:${random.uuid}
eureka.instance.hostname=gateway-nb5y.onrender.com
eureka.instance.non-secure-port=80
eureka.instance.secure-port=443
eureka.instance.secure-port-enabled=true
eureka.instance.non-secure-port-enabled=false
eureka.instance.prefer-ip-address=false

# URLs de la instancia
eureka.instance.home-page-url=https://gateway-nb5y.onrender.com/
eureka.instance.status-page-url=https://gateway-nb5y.onrender.com/actuator/info
eureka.instance.health-check-url=https://gateway-nb5y.onrender.com/actuator/health

# Configuración de registro
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true

# Configuración de heartbeat (más tolerante para Render)
eureka.instance.lease-renewal-interval-in-seconds=30
eureka.instance.lease-expiration-duration-in-seconds=90

# Reintentos de registro
eureka.client.registry-fetch-interval-seconds=30
eureka.client.initial-instance-info-replication-interval-seconds=40

# ============================================
# CONFIGURACIÓN PARA RENDER
# ============================================
server.forward-headers-strategy=framework

# ============================================
# JWT CONFIGURATION
# ============================================
security.jwt.secret-key=Y/I5T3T1aSOP+BezsicbSiUtzIZWxdcOVnylSYlJl/H22uPQID8VGjfzc5U5cVhKA6qm17V2yMP/mlrlTIkb+g==
security.jwt.expiration-time=86400000

# ============================================
# CONFIGURACIÓN DE SPRING CLOUD GATEWAY MVC
# ============================================

# --- Ruta 0: Autenticación (pública) ---
spring.cloud.gateway.mvc.routes[0].id=autentificacion-auth
spring.cloud.gateway.mvc.routes[0].uri=lb://AUTENTIFICACION-API
spring.cloud.gateway.mvc.routes[0].predicates[0]=Path=/api/auth/**

# --- Ruta 1: Usuarios (protegida) ---
spring.cloud.gateway.mvc.routes[1].id=autentificacion-usuarios
spring.cloud.gateway.mvc.routes[1].uri=lb://AUTENTIFICACION-API
spring.cloud.gateway.mvc.routes[1].predicates[0]=Path=/api/usuarios/**

# --- Ruta 2: Roles (protegida) ---
spring.cloud.gateway.mvc.routes[2].id=autentificacion-roles
spring.cloud.gateway.mvc.routes[2].uri=lb://AUTENTIFICACION-API
spring.cloud.gateway.mvc.routes[2].predicates[0]=Path=/api/roles/**

# --- Ruta 3: Perfiles (protegida) ---
spring.cloud.gateway.mvc.routes[3].id=autentificacion-perfiles
spring.cloud.gateway.mvc.routes[3].uri=lb://AUTENTIFICACION-API
spring.cloud.gateway.mvc.routes[3].predicates[0]=Path=/api/perfiles/**

# --- Ruta 4: Preferencias (protegida) ---
spring.cloud.gateway.mvc.routes[4].id=autentificacion-preferencias
spring.cloud.gateway.mvc.routes[4].uri=lb://AUTENTIFICACION-API
spring.cloud.gateway.mvc.routes[4].predicates[0]=Path=/api/preferencias/**

# --- Ruta 5: Aceptaciones (protegida) ---
spring.cloud.gateway.mvc.routes[5].id=autentificacion-aceptaciones
spring.cloud.gateway.mvc.routes[5].uri=lb://AUTENTIFICACION-API
spring.cloud.gateway.mvc.routes[5].predicates[0]=Path=/api/aceptaciones/**

# --- Ruta 6: Usuario-Membresías (protegida) ---
spring.cloud.gateway.mvc.routes[6].id=autentificacion-usuario-membresias
spring.cloud.gateway.mvc.routes[6].uri=lb://AUTENTIFICACION-API
spring.cloud.gateway.mvc.routes[6].predicates[0]=Path=/api/usuario-membresias/**

# --- Ruta 7: Documentos Legales (protegida) ---
spring.cloud.gateway.mvc.routes[7].id=autentificacion-documentos
spring.cloud.gateway.mvc.routes[7].uri=lb://AUTENTIFICACION-API
spring.cloud.gateway.mvc.routes[7].predicates[0]=Path=/api/documentoslegales/**

# --- Ruta 8: Membresías (protegida) ---
spring.cloud.gateway.mvc.routes[8].id=autentificacion-membresias
spring.cloud.gateway.mvc.routes[8].uri=lb://AUTENTIFICACION-API
spring.cloud.gateway.mvc.routes[8].predicates[0]=Path=/api/membresias/**

# --- Ruta 9: Tipos de Deporte (protegida) ---
spring.cloud.gateway.mvc.routes[9].id=autentificacion-tiposdeporte
spring.cloud.gateway.mvc.routes[9].uri=lb://AUTENTIFICACION-API
spring.cloud.gateway.mvc.routes[9].predicates[0]=Path=/api/tiposdeporte/**

# ============================================
# CONFIGURACIÓN DE SPRING CLOUD LOADBALANCER
# ============================================
spring.cloud.loadbalancer.ribbon.enabled=false
spring.cloud.loadbalancer.cache.enabled=true
spring.cloud.loadbalancer.cache.ttl=30s

# ============================================
# CONFIGURACIÓN DE TIMEOUTS
# ============================================
spring.cloud.gateway.httpclient.connect-timeout=10000
spring.cloud.gateway.httpclient.response-timeout=60000

# ============================================
# ACTUATOR
# ============================================
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=always

# ============================================
# LOGGING
# ============================================
logging.level.org.esfe.Gateway=INFO
logging.level.org.springframework.cloud.gateway=INFO
logging.level.org.springframework.web=INFO
logging.level.com.netflix.eureka=INFO
logging.level.com.netflix.discovery=INFO